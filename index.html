<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>График отпусков</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@500&display=swap" rel="stylesheet" />
  <script defer src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    body {
      font-family: 'Nunito', sans-serif;
      background-color: #3a3330;
      color: white;
      margin: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
      justify-content: center;
    }
    select, button {
      padding: 10px 15px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      background-color: #ef6f2e;
      color: white;
      cursor: pointer;
    }
    #status {
      margin-top: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <div class="controls">
    <select id="month-select"></select>
    <select id="year-select"></select>
    <button id="load-btn">Показать</button>
  </div>

  <div id="status"></div>

  <script>
    window.addEventListener("DOMContentLoaded", async () => {
      // ✅ Только теперь создаём Supabase
      const { createClient } = supabase;
      const supabaseClient = createClient(
        'https://mhtbolnovisgdliphsmf.supabase.co',
        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1odGJvbG5vdmlzZ2RsaXBoc21mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE4Mjk1OTYsImV4cCI6MjA2NzQwNTU5Nn0.ureoaGoJ9Dsp6bRAGmqA9x0his3eRamYGs6fOXQOmB0'
      );

      const MONTHS = ['Январь','Февраль','Март','Апрель','Май','Июнь','Июль','Август','Сентябрь','Октябрь','Ноябрь','Декабрь'];
      const monthSelect = document.getElementById('month-select');
      const yearSelect = document.getElementById('year-select');
      const status = document.getElementById('status');

      // Заполнение селектов
      MONTHS.forEach((m, i) => monthSelect.appendChild(new Option(m, i)));
      for (let y = 2025; y <= 2029; y++) yearSelect.appendChild(new Option(y, y));
      monthSelect.value = new Date().getMonth();
      yearSelect.value = new Date().getFullYear();

      document.getElementById('load-btn').onclick = async () => {
        const year = +yearSelect.value;
        const month = +monthSelect.value;

        const { data, error } = await supabaseClient
          .from('vacations')
          .select('*')
          .eq('year', year)
          .eq('month', month);

        if (error) {
          status.textContent = '❌ Ошибка загрузки';
        } else {
          status.textContent = `✅ Загружено: ${data.length} записей`;
        }
      };
    });
  </script>
</body>
</html>
